// --- UPDATED DATA FETCHING FOR IOS 9 ---
  function updateWeather() {
    // We create a "script" tag to bypass CORS. This is the most stable way for iOS 9.
    var script = document.createElement('script');
    
    // Open-Meteo API using JSONP (callback=setWeather)
    script.src = "https://api.open-meteo.com/v1/forecast?latitude=39.88&longitude=-82.99&current=temperature_2m,weather_code&temperature_unit=fahrenheit&timezone=auto&format=json&callback=setWeather";
    
    document.body.appendChild(script);
    
    // Clean up the script tag after it loads
    script.onload = function() {
      document.body.removeChild(script);
    };
  }

  // This function is called automatically when the weather data arrives
  window.setWeather = function(data) {
    try {
      var temp = Math.round(data.current.temperature_2m);
      var code = data.current.weather_code;
      
      getEl('wx-temp').innerText = temp + "Â°";
      getEl('wx-cond').innerText = getWmoDesc(code);
      getEl('wx-error').style.display = "none";
    } catch(e) {
      getEl('wx-error').style.display = "block";
      getEl('wx-error').innerText = "Weather Render Error";
    }
  };

  // Helper for weather descriptions (Open-Meteo Standard)
  function getWmoDesc(code) {
    var codes = {
      0: "Clear Sky", 1: "Mainly Clear", 2: "Partly Cloudy", 3: "Overcast",
      45: "Fog", 48: "Depositing Rime Fog", 51: "Light Drizzle", 53: "Drizzle",
      55: "Heavy Drizzle", 61: "Slight Rain", 63: "Rain", 65: "Heavy Rain",
      71: "Slight Snow", 73: "Snow", 75: "Heavy Snow", 95: "Thunderstorm"
    };
    return codes[code] || "Fair";
  }
