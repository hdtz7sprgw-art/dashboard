<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Hub</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">

<meta http-equiv="refresh" content="1200">

<style>
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  html, body {
    height: 100%; width: 100%; margin: 0; padding: 0;
    overflow: hidden; background-color: #000;
    font-family: -apple-system, "Helvetica Neue", Helvetica, Arial, sans-serif;
    color: #fff; -webkit-font-smoothing: antialiased;
  }

  .container {
    display: -webkit-flex; display: flex;
    -webkit-flex-direction: column; flex-direction: column;
    height: 100%; padding: 12px;
  }

  .row { display: -webkit-flex; display: flex; width: 100%; margin-bottom: 12px; }
  .row:last-child { margin-bottom: 0; }
  .col-1 { -webkit-flex: 1; flex: 1; }
  .col-2 { -webkit-flex: 2; flex: 2; }

  .card {
    background-color: #1c1c1e; border-radius: 14px;
    padding: 14px; margin-right: 12px;
    display: -webkit-flex; display: flex;
    -webkit-flex-direction: column; flex-direction: column;
    position: relative; overflow: hidden;
  }
  .card:last-child { margin-right: 0; }

  .header {
    font-size: 11px; text-transform: uppercase; letter-spacing: 1px;
    color: #8e8e93; font-weight: 600; margin-bottom: 8px;
  }

  /* Clock */
  #time { font-size: 60px; font-weight: 200; line-height: 1; letter-spacing: -1px; margin-top: auto; }
  #date { font-size: 16px; color: #aeaeb2; margin-top: 4px; margin-bottom: auto; }
  
  /* Progress */
  .progress-container { margin-top: 15px; }
  .p-row { display: -webkit-flex; display: flex; -webkit-align-items: center; align-items: center; margin-bottom: 6px; }
  .p-label { width: 35px; font-size: 10px; color: #636366; font-weight: bold; }
  .p-track { -webkit-flex: 1; flex: 1; height: 4px; background: #3a3a3c; border-radius: 2px; overflow: hidden; }
  .p-fill { height: 100%; background: #0a84ff; width: 0%; transition: width 0.5s; }
  .p-val { width: 30px; text-align: right; font-size: 10px; color: #8e8e93; }

  /* Weather */
  .wx-wrapper { display: -webkit-flex; display: flex; -webkit-flex-direction: column; flex-direction: column; height: 100%; -webkit-justify-content: center; justify-content: center; }
  #wx-temp { font-size: 42px; font-weight: 300; }
  #wx-cond { font-size: 15px; color: #aeaeb2; margin-top: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  #wx-loc { margin-top: 8px; font-size: 11px; color: #ff9f0a; font-weight: 500; }

  /* Calendar */
  .cal-grid { display: table; width: 100%; height: 100%; table-layout: fixed; border-collapse: collapse; }
  .cal-row { display: table-row; }
  .cal-cell { display: table-cell; text-align: center; vertical-align: middle; font-size: 11px; color: #8e8e93; }
  .cal-head { color: #636366; font-weight: 700; font-size: 9px; padding-bottom: 5px; }
  .is-today { background-color: #323232; color: #fff; font-weight: bold; border-radius: 50%; width: 24px; height: 24px; margin: 0 auto; line-height: 24px; display: block; }

  /* News */
  #news-list { list-style: none; padding: 0; margin: 0; }
  #news-list li { margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #2c2c2e; }
  #news-list a { color: #e5e5ea; text-decoration: none; font-size: 13px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  .news-source { font-size: 10px; color: #636366; margin-top: 2px; display: block; }
  .error-text { color: #ff453a; font-size: 10px; margin-top: 5px; }
</style>
</head>
<body>

<div class="container">
  <div class="row" style="height: 35%;">
    <div class="card col-2">
      <div id="date">Loading...</div>
      <div id="time">--:--</div>
      <div class="progress-container">
        <div class="p-row"><div class="p-label">DAY</div><div class="p-track"><div class="p-fill" id="p-day"></div></div><div class="p-val" id="t-day">0%</div></div>
        <div class="p-row"><div class="p-label">YEAR</div><div class="p-track"><div class="p-fill" id="p-year"></div></div><div class="p-val" id="t-year">0%</div></div>
      </div>
    </div>
    <div class="card col-1">
      <div class="header">Weather</div>
      <div class="wx-wrapper">
        <div id="wx-temp">--°</div>
        <div id="wx-cond">Loading...</div>
        <div id="wx-loc">Columbus</div>
        <div id="wx-error" class="error-text" style="display:none"></div>
      </div>
    </div>
  </div>

  <div class="row" style="height: 65%;">
    <div class="card col-1">
      <div class="header"><span id="cal-month-name">Calendar</span></div>
      <div id="cal-wrap" style="height:100%"></div>
    </div>
    <div class="card col-2">
      <div class="header">Reuters <span id="news-time" style="float:right; opacity:0.5; font-weight:400">--:--</span></div>
      <ul id="news-list"><li>Loading headlines...</li></ul>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';

  var getEl = function(id) { return document.getElementById(id); };
  var pad = function(n) { return n < 10 ? '0' + n : n; };

  // --- CLOCK ---
  function updateClock() {
    var now = new Date();
    var h = now.getHours();
    var m = now.getMinutes();
    var ampm = h >= 12 ? 'pm' : 'am';
    h = h % 12 || 12;
    getEl('time').innerHTML = h + ':' + pad(m) + '<span style="font-size:20px; margin-left:4px; text-transform:uppercase;">' + ampm + '</span>';
    getEl('date').innerText = now.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });

    var start = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    var dayPct = ((now - start) / 86400000) * 100;
    getEl('p-day').style.width = dayPct + "%";
    getEl('t-day').innerText = Math.floor(dayPct) + "%";

    var startYr = new Date(now.getFullYear(), 0, 1);
    var yrPct = ((now - startYr) / (new Date(now.getFullYear(), 11, 31, 23, 59) - startYr)) * 100;
    getEl('p-year').style.width = yrPct + "%";
    getEl('t-year').innerText = Math.floor(yrPct) + "%";
  }

  // --- WEATHER (JSONP Method) ---
  window.setWeather = function(data) {
    try {
      var temp = Math.round(data.current.temperature_2m);
      var code = data.current.weather_code;
      var descriptions = {
        0: "Clear Sky", 1: "Mainly Clear", 2: "Partly Cloudy", 3: "Overcast",
        45: "Fog", 51: "Light Drizzle", 61: "Slight Rain", 63: "Rain",
        71: "Slight Snow", 73: "Snow", 95: "Thunderstorm"
      };
      getEl('wx-temp').innerText = temp + "°";
      getEl('wx-cond').innerText = descriptions[code] || "Fair";
      getEl('wx-error').style.display = "none";
    } catch(e) { 
      getEl('wx-error').innerText = "Render Error"; 
      getEl('wx-error').style.display = "block";
    }
  };

  function updateWeather() {
    var s = document.createElement('script');
    s.src = "https://api.open-meteo.com/v1/forecast?latitude=39.88&longitude=-82.99&current=temperature_2m,weather_code&temperature_unit=fahrenheit&timezone=auto&callback=setWeather";
    document.body.appendChild(s);
    setTimeout(function(){ if(s.parentNode) s.parentNode.removeChild(s); }, 5000);
  }

  // --- NEWS ---
  function updateNews() {
    var url = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent("https://news.google.com/rss/search?q=site:reuters.com+when:1d&hl=en-US&gl=US&ceid=US:en");
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4 && xhr.status === 200) {
        try {
          var items = JSON.parse(xhr.responseText).items.slice(0, 5);
          var html = "";
          for(var i=0; i<items.length; i++) {
            html += '<li><a href="#">' + items[i].title.split(' - ')[0] + '</a>';
            html += '<span class="news-source">' + items[i].pubDate.substring(11,16) + '</span></li>';
          }
          getEl('news-list').innerHTML = html;
          getEl('news-time').innerText = pad(new Date().getHours()) + ":" + pad(new Date().getMinutes());
        } catch(e) {}
      }
    };
    xhr.open("GET", url, true);
    xhr.send();
  }

  // --- CALENDAR ---
  function renderCalendar() {
    var now = new Date(), y = now.getFullYear(), m = now.getMonth(), today = now.getDate();
    getEl('cal-month-name').innerText = now.toLocaleDateString('en-US', { month: 'long' });
    var first = new Date(y, m, 1).getDay(), last = new Date(y, m+1, 0).getDate();
    var html = '<div class="cal-grid"><div class="cal-row">', days = ['S','M','T','W','T','F','S'];
    for(var i=0; i<7; i++) html += '<div class="cal-cell cal-head">' + days[i] + '</div>';
    html += '</div><div class="cal-row">';
    for(var i=0; i<first; i++) html += '<div class="cal-cell"></div>';
    for(var d=1; d<=last; d++) {
      if((i+d-1)%7===0 && d!==1) html += '</div><div class="cal-row">';
      html += '<div class="cal-cell">' + (d===today ? '<span class="is-today">'+d+'</span>' : d) + '</div>';
    }
    getEl('cal-wrap').innerHTML = html + '</div></div>';
  }

  updateClock(); renderCalendar(); updateWeather(); updateNews();
  setInterval(updateClock, 1000);
  setInterval(updateWeather, 900000);
  setInterval(updateNews, 1800000);
})();
</script>
</body>
</html>
