<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Hub Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<style>
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html, body {
    height: 100%; width: 100%; margin: 0; padding: 0;
    overflow: hidden; background-color: #000;
    font-family: -apple-system, "Helvetica Neue", Helvetica, Arial, sans-serif;
    color: #fff;
  }

  .container { display: -webkit-flex; display: flex; -webkit-flex-direction: column; flex-direction: column; height: 100%; padding: 12px; }
  .row { display: -webkit-flex; display: flex; width: 100%; margin-bottom: 12px; }
  .col-1 { -webkit-flex: 1; flex: 1; }
  .col-2 { -webkit-flex: 2; flex: 2; }

  .card {
    background-color: #1c1c1e; border-radius: 16px;
    padding: 16px; margin-right: 12px;
    display: -webkit-flex; display: flex;
    -webkit-flex-direction: column; flex-direction: column;
    position: relative;
  }
  .card:last-child { margin-right: 0; }

  .header {
    font-size: 11px; text-transform: uppercase; letter-spacing: 1.2px;
    color: #8e8e93; font-weight: 700; margin-bottom: 10px;
    display: -webkit-flex; display: flex; -webkit-justify-content: space-between; justify-content: space-between;
  }

  /* --- TOP DATA RIBBON --- */
  .status-ribbon {
    font-size: 11px; font-weight: 600; color: #0a84ff;
    margin-bottom: 8px; display: -webkit-flex; display: flex;
    -webkit-justify-content: space-between; justify-content: space-between;
    text-transform: uppercase; letter-spacing: 1px;
  }

  /* --- CLOCK --- */
  #time { font-size: 84px; font-weight: 200; line-height: 1; letter-spacing: -3px; color: #fff; margin-top: -5px; }
  #date { font-size: 18px; color: #aeaeb2; margin-bottom: 15px; font-weight: 400; }
  
  /* Progress Bars */
  .p-row { display: -webkit-flex; display: flex; -webkit-align-items: center; align-items: center; margin-bottom: 8px; }
  .p-label { width: 45px; font-size: 10px; color: #636366; font-weight: 800; }
  .p-track { -webkit-flex: 1; flex: 1; height: 6px; background: #3a3a3c; border-radius: 3px; overflow: hidden; margin: 0 10px; }
  .p-fill { height: 100%; background: #0a84ff; width: 0%; transition: width 1s; }
  .p-val { font-size: 10px; color: #8e8e93; width: 30px; text-align: right; }

  /* --- WEATHER --- */
  .wx-display { -webkit-flex: 1; flex: 1; display: -webkit-flex; display: flex; -webkit-flex-direction: column; flex-direction: column; -webkit-justify-content: center; justify-content: center; }
  #wx-temp { font-size: 56px; font-weight: 200; line-height: 1; }
  #wx-desc { font-size: 16px; color: #aeaeb2; margin-top: 8px; font-weight: 400; }

  /* --- NEWS (NARROW COLUMN) --- */
  #news-list { list-style: none; padding: 0; margin: 0; }
  #news-list li { margin-bottom: 12px; border-bottom: 1px solid #2c2c2e; padding-bottom: 8px; }
  #news-list a { color: #e5e5ea; text-decoration: none; font-size: 12px; line-height: 1.4; display: block; font-weight: 400; }
  .news-source { font-size: 9px; color: #636366; margin-top: 4px; display: block; text-transform: uppercase; }

  /* --- CALENDAR (WIDE COLUMN) --- */
  .cal-grid { display: table; width: 100%; height: 100%; table-layout: fixed; }
  .cal-row { display: table-row; }
  .cal-cell { display: table-cell; text-align: center; vertical-align: middle; font-size: 20px; color: #8e8e93; padding: 8px 0; }
  .cal-head { color: #0a84ff; font-weight: 700; font-size: 12px; padding-bottom: 10px; }
  .is-today { background-color: #ff3b30; color: #fff; font-weight: bold; border-radius: 50%; width: 40px; height: 40px; margin: 0 auto; line-height: 40px; display: block; }

  #footer-info { font-size: 11px; color: #48484a; text-align: center; margin-top: 10px; text-transform: uppercase; letter-spacing: 1px; }
</style>
</head>
<body>

<div class="container">
  <div class="row" style="height: 45%;">
    <div class="card col-2">
      <div class="status-ribbon">
        <span id="sys-focus">Focus: Connection</span>
        <span id="sys-battery">Batt: --%</span>
      </div>
      <div id="time">00:00</div>
      <div id="date">Loading...</div>
      
      <div class="p-row"><div class="p-label">DAY</div><div class="p-track"><div class="p-fill" id="p-day"></div></div><div class="p-val" id="v-day">0%</div></div>
      <div class="p-row"><div class="p-label">YEAR</div><div class="p-track"><div class="p-fill" id="p-year"></div></div><div class="p-val" id="v-year">0%</div></div>
    </div>

    <div class="card col-1">
      <div class="header">
        <span>Weather</span>
        <span id="wx-update" style="font-size:8px; opacity:0.4">--:--</span>
      </div>
      <div class="wx-display">
        <div id="wx-temp">--°</div>
        <div id="wx-desc">Syncing...</div>
      </div>
    </div>
  </div>

  <div class="row" style="height: 50%;">
    <div class="card col-1">
      <div class="header">Reuters</div>
      <ul id="news-list"><li>Updating news...</li></ul>
    </div>

    <div class="card col-2">
      <div class="header" id="cal-month-name">Calendar</div>
      <div id="cal-wrap" style="height:100%"></div>
    </div>
  </div>
  
  <div id="footer-info">System Active • Columbus Station</div>
</div>

<script>
(function() {
  'use strict';
  var getEl = function(id) { return document.getElementById(id); };

  // --- 1. CLOCK & PROGRESS ---
  function updateClock() {
    var now = new Date();
    var h = now.getHours(), m = now.getMinutes();
    var ampm = h >= 12 ? 'pm' : 'am';
    h = h % 12 || 12;
    getEl('time').innerHTML = h + ':' + (m < 10 ? '0'+m : m) + '<span style="font-size:24px; margin-left:8px; opacity:0.3;">' + ampm + '</span>';
    getEl('date').innerText = now.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });

    var dayPct = ((now - new Date(now.getFullYear(), now.getMonth(), now.getDate())) / 86400000) * 100;
    getEl('p-day').style.width = dayPct + "%";
    getEl('v-day').innerText = Math.floor(dayPct) + "%";

    var start = new Date(now.getFullYear(), 0, 1);
    var end = new Date(now.getFullYear() + 1, 0, 1);
    var yrPct = ((now - start) / (end - start)) * 100;
    getEl('p-year').style.width = yrPct + "%";
    getEl('v-year').innerText = Math.floor(yrPct) + "%";
  }

  // --- 2. WEATHER (Bypassing SSL Issues) ---
  window.setWx = function(data) {
    try {
      var cur = data.current_weather;
      getEl('wx-temp').innerText = Math.round(cur.temperature) + "°";
      var codes = {0:"Clear", 1:"Fair", 2:"Partly Cloudy", 3:"Cloudy", 45:"Fog", 61:"Rain", 95:"Storm"};
      getEl('wx-desc').innerText = codes[cur.weathercode] || "Clear";
      getEl('wx-update').innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    } catch(e) { getEl('wx-desc').innerText = "Parse Error"; }
  };

  function updateWeather() {
    var s = document.createElement('script');
    // We add a timestamp to force a fresh pull bypassing iPad cache
    s.src = "https://api.open-meteo.com/v1/forecast?latitude=39.96&longitude=-83.00&current_weather=true&temperature_unit=fahrenheit&callback=setWx&_=" + new Date().getTime();
    document.body.appendChild(s);
  }

  // --- 3. CALENDAR (Wide Layout) ---
  function renderCalendar() {
    var now = new Date(), y = now.getFullYear(), m = now.getMonth(), today = now.getDate();
    getEl('cal-month-name').innerText = now.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    var first = new Date(y, m, 1).getDay(), last = new Date(y, m+1, 0).getDate();
    var html = '<div class="cal-grid"><div class="cal-row">', days = ['SUN','MON','TUE','WED','THU','FRI','SAT'];
    for(var i=0; i<7; i++) html += '<div class="cal-cell cal-head">' + days[i] + '</div>';
    html += '</div><div class="cal-row">';
    for(var i=0; i<first; i++) html += '<div class="cal-cell"></div>';
    for(var d=1; d<=last; d++) {
      if((i+d-1)%7===0 && d!==1) html += '</div><div class="cal-row">';
      html += '<div class="cal-cell">' + (d===today ? '<span class="is-today">'+d+'</span>' : d) + '</div>';
    }
    getEl('cal-wrap').innerHTML = html + '</div></div>';
  }

  // --- 4. NEWS ---
  function updateNews() {
    var url = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent("https://news.google.com/rss/search?q=site:reuters.com+when:1d&hl=en-US&gl=US&ceid=US:en");
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4 && xhr.status === 200) {
        try {
          var items = JSON.parse(xhr.responseText).items.slice(0, 4);
          var html = "";
          for(var i=0; i<items.length; i++) {
            html += '<li><a href="#">' + items[i].title.split(' - ')[0] + '</a>';
            html += '<span class="news-source">' + items[i].pubDate.substring(11,16) + '</span></li>';
          }
          getEl('news-list').innerHTML = html;
        } catch(e){}
      }
    };
    xhr.open("GET", url, true);
    xhr.send();
  }

  function updateSystem() {
    if (navigator.getBattery) {
      navigator.getBattery().then(function(b) {
        getEl('sys-battery').innerText = 'Batt: ' + Math.floor(b.level * 100) + '%';
      });
    }
  }

  // --- START ---
  updateClock(); renderCalendar(); updateNews(); updateWeather(); updateSystem();
  setInterval(updateClock, 1000);
  setInterval(updateWeather, 900000); // 15 mins
  setInterval(updateNews, 1800000); // 30 mins
  setInterval(updateSystem, 60000);
})();
</script>
</body>
</html>
