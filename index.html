<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Hub</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">

<meta http-equiv="refresh" content="1200">

<style>
  /* --- RESET & BASE --- */
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden; /* Prevent scrolling */
    background-color: #000000;
    font-family: -apple-system, "Helvetica Neue", Helvetica, Arial, sans-serif;
    color: #ffffff;
    -webkit-font-smoothing: antialiased;
  }

  /* --- LAYOUT UTILITIES --- */
  .container {
    display: -webkit-flex;
    display: flex;
    -webkit-flex-direction: column;
    flex-direction: column;
    height: 100%;
    padding: 12px;
    background: #000;
  }

  .row {
    display: -webkit-flex;
    display: flex;
    width: 100%;
    margin-bottom: 12px;
  }
  
  .row:last-child { margin-bottom: 0; }

  /* Flex weighting */
  .col-1 { -webkit-flex: 1; flex: 1; }
  .col-2 { -webkit-flex: 2; flex: 2; }
  .col-3 { -webkit-flex: 3; flex: 3; }

  /* --- CARD STYLING --- */
  .card {
    background-color: #1c1c1e; /* Apple Dark Mode Gray */
    border-radius: 14px;
    padding: 14px;
    margin-right: 12px;
    display: -webkit-flex;
    display: flex;
    -webkit-flex-direction: column;
    flex-direction: column;
    position: relative;
    overflow: hidden;
  }
  
  .card:last-child { margin-right: 0; }

  /* Headers */
  .header {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #8e8e93;
    font-weight: 600;
    margin-bottom: 8px;
    display: -webkit-flex;
    display: flex;
    -webkit-justify-content: space-between;
    justify-content: space-between;
  }

  /* --- SPECIFIC CARDS --- */

  /* 1. CLOCK (Top Left) */
  #time {
    font-size: 60px;
    font-weight: 200; /* Thin font looks elegant */
    line-height: 1;
    letter-spacing: -1px;
    margin-top: auto;
    margin-bottom: 0;
  }
  #date {
    font-size: 16px;
    color: #aeaeb2;
    margin-bottom: auto;
    margin-top: 4px;
  }
  
  /* Progress Bars in Clock Card */
  .progress-container { margin-top: 15px; }
  .p-row {
    display: -webkit-flex;
    display: flex;
    -webkit-align-items: center;
    align-items: center;
    margin-bottom: 6px;
  }
  .p-label {
    width: 35px; 
    font-size: 10px; 
    color: #636366; 
    font-weight: bold;
  }
  .p-track {
    -webkit-flex: 1; flex: 1;
    height: 4px;
    background: #3a3a3c;
    border-radius: 2px;
    overflow: hidden;
  }
  .p-fill {
    height: 100%;
    background: #0a84ff; /* iOS Blue */
    width: 0%;
    transition: width 0.5s;
  }
  .p-val {
    width: 30px; 
    text-align: right; 
    font-size: 10px; 
    color: #8e8e93;
  }

  /* 2. WEATHER (Top Right) */
  .wx-wrapper {
    display: -webkit-flex;
    display: flex;
    -webkit-flex-direction: column;
    flex-direction: column;
    height: 100%;
    -webkit-justify-content: center;
    justify-content: center;
  }
  #wx-temp {
    font-size: 42px;
    font-weight: 300;
  }
  #wx-cond {
    font-size: 15px;
    color: #aeaeb2;
    margin-top: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  #wx-sunset {
    margin-top: 8px;
    font-size: 11px;
    color: #ff9f0a; /* Sunset Orange */
    font-weight: 500;
  }

  /* 3. CALENDAR (Bottom Left) */
  .cal-grid {
    display: table;
    width: 100%;
    height: 100%;
    table-layout: fixed;
    border-collapse: collapse;
  }
  .cal-row { display: table-row; }
  .cal-cell {
    display: table-cell;
    text-align: center;
    vertical-align: middle;
    font-size: 11px;
    color: #8e8e93;
  }
  .cal-head {
    color: #636366;
    font-weight: 700;
    font-size: 9px;
    padding-bottom: 5px;
  }
  .is-today {
    background-color: #323232;
    color: #fff;
    font-weight: bold;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    margin: 0 auto;
    line-height: 24px; /* Vertical center trick */
    display: block; /* Required for margin auto on span/div */
  }

  /* 4. NEWS (Bottom Right) */
  #news-list {
    list-style: none;
    padding: 0;
    margin: 0;
    overflow: hidden;
  }
  #news-list li {
    margin-bottom: 12px;
    padding-bottom: 12px;
    border-bottom: 1px solid #2c2c2e;
  }
  #news-list li:last-child { border: none; }
  #news-list a {
    color: #e5e5ea;
    text-decoration: none;
    font-size: 13px;
    line-height: 1.4;
    display: block;
    /* Limit to 2 lines */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .news-source {
    font-size: 10px;
    color: #636366;
    margin-top: 2px;
    display: block;
  }

  /* Error State */
  .error-text { color: #ff453a; font-size: 11px; }

</style>
</head>
<body>

<div class="container">
  
  <div class="row" style="height: 35%;">
    
    <div class="card col-2">
      <div id="date">Loading...</div>
      <div id="time">--:--</div>
      
      <div class="progress-container">
        <div class="p-row">
          <div class="p-label">DAY</div>
          <div class="p-track"><div class="p-fill" id="p-day"></div></div>
          <div class="p-val" id="t-day">0%</div>
        </div>
        <div class="p-row">
          <div class="p-label">YEAR</div>
          <div class="p-track"><div class="p-fill" id="p-year"></div></div>
          <div class="p-val" id="t-year">0%</div>
        </div>
      </div>
    </div>

    <div class="card col-1">
      <div class="header">
        <span>Temp</span>
        <span style="opacity:0.5">43207</span>
      </div>
      <div class="wx-wrapper">
        <div id="wx-temp">--°</div>
        <div id="wx-cond">Checking...</div>
        <div id="wx-sunset"></div>
      </div>
    </div>

  </div>

  <div class="row" style="height: 65%;">
    
    <div class="card col-1">
      <div class="header">
        <span id="cal-month-name">Calendar</span>
      </div>
      <div id="cal-wrap" style="height:100%"></div>
    </div>

    <div class="card col-2">
      <div class="header">
        <span>Reuters</span>
        <span id="news-time" style="font-weight:400; opacity:0.5">Updated</span>
      </div>
      <ul id="news-list">
        <li>Loading headlines...</li>
      </ul>
    </div>

  </div>
</div>

<script>
(function() {
  'use strict';

  // --- CONFIGURATION ---
  var ZIP_CODE = "43207"; // Columbus, OH
  var WEATHER_URL = "https://wttr.in/" + ZIP_CODE + "?format=%t|%C|%s&u"; 
  // Using RSS2JSON to bypass CORS on old Safari
  var RSS_URL = "https://news.google.com/rss/search?q=site:reuters.com+when:1d&hl=en-US&gl=US&ceid=US:en";
  var RSS_API = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(RSS_URL);

  // --- UTILS ---
  function getEl(id) { return document.getElementById(id); }
  function pad(n) { return n < 10 ? '0' + n : n; }

  // --- CLOCK & PROGRESS ---
  function updateClock() {
    var now = new Date();
    
    // Time
    var hours = now.getHours();
    var minutes = now.getMinutes();
    var ampm = hours >= 12 ? 'pm' : 'am';
    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'
    getEl('time').innerHTML = hours + ':' + pad(minutes) + '<span style="font-size:20px; margin-left:4px; text-transform:uppercase;">' + ampm + '</span>';
    
    // Date
    var options = { weekday: 'long', month: 'long', day: 'numeric' };
    getEl('date').innerText = now.toLocaleDateString('en-US', options);

    // Day Progress
    var startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0,0,0);
    var endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23,59,59);
    var dayPct = ((now - startOfDay) / (endOfDay - startOfDay)) * 100;
    getEl('p-day').style.width = dayPct + "%";
    getEl('t-day').innerText = Math.floor(dayPct) + "%";

    // Year Progress
    var startOfYear = new Date(now.getFullYear(), 0, 1);
    var endOfYear = new Date(now.getFullYear(), 11, 31, 23, 59, 59);
    var yearPct = ((now - startOfYear) / (endOfYear - startOfYear)) * 100;
    getEl('p-year').style.width = yearPct + "%";
    getEl('t-year').innerText = Math.floor(yearPct) + "%";
  }

  // --- CALENDAR GENERATOR ---
  function renderCalendar() {
    var now = new Date();
    var year = now.getFullYear();
    var month = now.getMonth();
    var today = now.getDate();

    getEl('cal-month-name').innerText = now.toLocaleDateString('en-US', { month: 'long' });

    var firstDay = new Date(year, month, 1).getDay(); // 0 = Sun
    var daysInMonth = new Date(year, month + 1, 0).getDate();

    var html = '<div class="cal-grid"><div class="cal-row">';
    var days = ['S','M','T','W','T','F','S'];
    
    // Header
    for(var i=0; i<7; i++) {
      html += '<div class="cal-cell cal-head">' + days[i] + '</div>';
    }
    html += '</div><div class="cal-row">';

    // Empty slots
    var slot = 0;
    for (var i = 0; i < firstDay; i++) {
      html += '<div class="cal-cell"></div>';
      slot++;
    }

    // Days
    for (var d = 1; d <= daysInMonth; d++) {
      if (slot % 7 === 0 && slot !== 0) html += '</div><div class="cal-row">'; // New Row
      
      var isToday = (d === today) ? '<span class="is-today">' + d + '</span>' : d;
      html += '<div class="cal-cell">' + isToday + '</div>';
      slot++;
    }
    
    html += '</div></div>';
    getEl('cal-wrap').innerHTML = html;
  }

  // --- DATA FETCHING (Legacy XHR) ---
  function fetchUrl(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          callback(null, xhr.responseText);
        } else {
          callback("Error " + xhr.status);
        }
      }
    };
    xhr.open("GET", url, true);
    xhr.send();
  }

  function updateWeather() {
    fetchUrl(WEATHER_URL, function(err, data) {
      if(err) {
        getEl('wx-cond').innerHTML = "<span class='error-text'>Offline</span>";
        return;
      }
      // Format expected: 34°F|Light Snow|17:45
      var parts = data.split('|');
      if(parts.length >= 3) {
        getEl('wx-temp').innerText = parts[0].trim();
        getEl('wx-cond').innerText = parts[1].trim();
        getEl('wx-sunset').innerText = "Sunset " + parts[2].trim();
      }
    });
  }

  function updateNews() {
    fetchUrl(RSS_API, function(err, data) {
      if(err) return;
      
      try {
        var json = JSON.parse(data);
        var items = json.items.slice(0, 5); // Take top 5
        var html = "";
        
        for(var i=0; i<items.length; i++) {
          var title = items[i].title;
          // Clean up Reuters titles which often have " - Reuters" at the end
          title = title.replace(" - Reuters", "");
          
          html += '<li><a href="#">' + title + '</a>';
          html += '<span class="news-source">' + items[i].pubDate.substring(11,16) + '</span></li>';
        }
        getEl('news-list').innerHTML = html;
        
        var now = new Date();
        getEl('news-time').innerText = pad(now.getHours()) + ":" + pad(now.getMinutes());
        
      } catch(e) {
        getEl('news-list').innerHTML = "<li>News parsing error</li>";
      }
    });
  }

  // --- INIT ---
  updateClock();
  renderCalendar();
  updateWeather();
  updateNews();

  // --- TIMERS ---
  setInterval(updateClock, 1000);       // Every second
  setInterval(updateWeather, 900000);   // Every 15 mins
  setInterval(updateNews, 1800000);     // Every 30 mins
  // Refresh page happens via meta tag every 20 mins

})();
</script>
</body>
</html>
